{% extends "base.html" %}
{% block content %}
<h1>Consignors</h1>

<form method="get" class="mb-3">
  <input name="q" placeholder="Search name, email, phone" value="{{ q }}" />
  <button type="submit">Search</button>
  <a href="{{ url_for('consignors_new') }}">+ New Consignor</a>
</form>

<table border="1" cellpadding="4" cellspacing="0">
  <tr>
    <th>Name</th>
    <th>Contact</th>
    <th>Commission %</th>
    <th>Advance Balance</th>
    <th>Items</th>
    <th>Sold</th>
    <th>Created</th>
    <th></th>
  </tr>
  {% for c in consignors %}
    {% set stats = stats_by_id.get(c.id, {}) %}
    <tr>
      <td>
        <a href="{{ url_for('consignors_detail', cid=c.id) }}">{{ c.name }}</a>
      </td>
      <td>
        {% if c.email %}{{ c.email }}<br>{% endif %}
        {% if c.phone %}{{ c.phone }}{% endif %}
      </td>
      <td>{{ "%.1f"|format(c.commission_pct or 0) }}</td>
      <td>${{ "%.2f"|format(c.advance_balance or 0) }}</td>
      <td>{{ stats.total or 0 }}</td>
      <td>{{ stats.sold or 0 }}</td>
      <td>{{ c.created_at }}</td>
      <td>
        <a href="{{ url_for('consignors_edit', cid=c.id) }}">Edit</a>
      </td>
    </tr>
  {% endfor %}
</table>
{% endblock %}
