<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Inventory - FlashBidz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif; margin:0; background:#f6f7f9; }
    main { padding:24px; max-width:1200px; margin:0 auto; }
    h1 { margin-top:0; }

    .toolbar {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:16px;
      align-items:center;
    }
    .toolbar form { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }

    input[type="text"], select {
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #ddd;
      font-size:14px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 6px 20px rgba(0,0,0,.06);
      font-size:14px;
    }
    th, td {
      padding:8px 10px;
      border-bottom:1px solid #eee;
      text-align:left;
    }
    th {
      background:#111;
      color:#fff;
      position:sticky;
      top:0;
      z-index:1;
    }
    tbody tr:nth-child(even) { background:#fafbfc; }
    tbody tr:hover { background:#f1f5ff; }

    .status-sold { color:#0a7a15; font-weight:600; }
    .status-available { color:#555; }
    .missing-location { background:#fff8e1 !important; }

    .pill {
      display:inline-flex;
      padding:2px 6px;
      border-radius:999px;
      font-size:11px;
      border:1px solid #ccc;
      background:#fafafa;
    }

    .btn-sm {
      padding:4px 8px;
      font-size:12px;
      border-radius:6px;
      border:1px solid #ccc;
      background:#fff;
      text-decoration:none;
      color:#333;
    }
    .btn-sm:hover { background:#f0f0f0; }

    @media (max-width:900px) {
      table { font-size:12px; }
      th, td { padding:6px 6px; }
    }
  </style>
</head>
<body>
  {% include "_navbar.html" %}
  <main>
    <h1>Inventory</h1>

    <div class="toolbar">
      <form method="get" action="/items">
        <input type="text" name="q" placeholder="Search by title / SKU"
               value="{{ q or '' }}"/>

        <!-- Building filter -->
        <select name="building">
          <option value="">All Buildings</option>
          {% set current_building = request.args.get('building','') %}
          {% for b in items|map(attribute='building')|reject('equalto', None)|unique %}
            <option value="{{ b }}"
              {% if b == current_building %}selected{% endif %}>
              {{ b }}
            </option>
          {% endfor %}
        </select>

        <button class="btn-sm" type="submit">Filter</button>
      </form>

      <a class="btn-sm" href="/items/new">+ New Item</a>
    </div>

    <table>
      <thead>
        <tr>
          <th>SKU</th>
          <th>Title</th>
          <th>Ownership</th>
          <th>Consignor</th>
          <th>Building</th>
          <th>Room</th>
          <th>Shelf</th>
          <th>Tote</th>
          <th>Status</th>
          <th>Cost</th>
          <th>Sale</th>
          <th>Buyer</th>
          <th>Actions</th>
          <th>Location</th> 
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          {% set has_location = (it.building or it.room or it.shelf or it.tote) %}
          <tr class="{{ '' if has_location else 'missing-location' }}">
            <td>
              {{ it.location or '' }}
              {% if it.location_detail %}
                <br><small>{{ it.location_detail }}</small>
              {% endif %}
            </td>
            <td>{{ it.sku }}</td>
            <td>{{ it.title }}</td>
            <td><span class="pill">{{ it.ownership or '' }}</span></td>
            <td>{{ it.consignor or '' }}</td>
            <td>{{ it.building or '' }}</td>
            <td>{{ it.room or '' }}</td>
            <td>{{ it.shelf or '' }}</td>
            <td>{{ it.tote or '' }}</td>
            <td>
              {% if it.status == 'sold' %}
                <span class="status-sold">Sold</span>
              {% else %}
                <span class="status-available">Available</span>
              {% endif %}
            </td>
            <td>{{ it.cost_cents|money }}</td>
            <td>{{ it.sale_price_cents|money }}</td>
            <td>{{ it.buyer or '' }}</td>
            <td>
              <a class="btn-sm" href="/items/{{ it.id }}/print">Label</a>
              <a class="btn-sm" href="/items/{{ it.id }}/sell">Sell</a>
              <a class="btn-sm" href="/items/{{ it.id }}/photos">Photos</a>
              <form method="post" action="/items/{{ it.id }}/delete"
                    style="display:inline"
                    onsubmit="return confirm('Delete this item?');">
                <button class="btn-sm" type="submit">Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </main>
</body>
</html>
