<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Items - FlashBidz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      margin: 0;
      background: #f5f6f8;
    }
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    h1 {
      margin: 0 0 16px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .btn-primary {
      background:#e60000;
      color:#fff;
      border:none;
      border-radius:8px;
      padding:9px 14px;
      font-weight:600;
      text-decoration:none;
      display:inline-block;
    }

    /* Summary cards */
    .summary-row {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:16px;
    }
    .summary-card {
      flex:1;
      min-width:150px;
      background:#fff;
      border-radius:10px;
      padding:10px 12px;
      box-shadow:0 3px 10px rgba(0,0,0,0.04);
    }
    .summary-card .label {
      font-size:12px;
      color:#777;
      margin-bottom:2px;
    }
    .summary-card .value {
      font-size:16px;
      font-weight:600;
    }

    /* Filters form */
    .filters {
      background:#fff;
      border-radius:10px;
      padding:12px;
      margin-bottom:16px;
      box-shadow:0 3px 10px rgba(0,0,0,0.04);
    }
    .filters-row {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:8px;
    }
    .filters-row > div {
      flex:1;
      min-width:150px;
    }
    label {
      display:block;
      font-size:12px;
      font-weight:600;
      margin-bottom:2px;
    }
    input, select {
      width:100%;
      box-sizing:border-box;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #ddd;
      font:inherit;
    }
    .filters-actions {
      display:flex;
      gap:8px;
      margin-top:6px;
    }
    .btn-small {
      padding:6px 10px;
      border-radius:6px;
      border:none;
      font-size:13px;
      cursor:pointer;
    }
    .btn-apply {
      background:#e60000;
      color:#fff;
    }
    .btn-reset {
      background:#eee;
      color:#333;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
    }

    /* Items table */
    table {
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 3px 10px rgba(0,0,0,0.04);
      font-size:13px;
    }
    th, td {
      padding:8px 8px;
      border-bottom:1px solid #eee;
      text-align:left;
      vertical-align:top;
    }
    th {
      background:#fafafa;
      font-weight:600;
      font-size:12px;
      color:#555;
      white-space:nowrap;
    }
    tr:last-child td {
      border-bottom:none;
    }

    .tag {
      display:inline-block;
      padding:2px 6px;
      border-radius:6px;
      font-size:11px;
      font-weight:600;
    }
    .tag-owned {
      background:#e3f2fd;
      color:#1565c0;
    }
    .tag-consigned {
      background:#e8f5e9;
      color:#2e7d32;
    }
    .tag-internal {
      background:#fff3e0;
      color:#ef6c00;
    }
    .tag-sold {
      background:#eeeeee;
      color:#444;
    }

    .actions a {
      font-size:12px;
      margin-right:6px;
      text-decoration:none;
      color:#1565c0;
    }
    .actions a.delete-link {
      color:#b71c1c;
    }

    @media (max-width: 900px) {
      th:nth-child(6),
      td:nth-child(6), /* shelf/tote */
      th:nth-child(8),
      td:nth-child(8)  /* buyer */
      { display:none; }
    }
  </style>
</head>
<body>
  {% include "_navbar.html" %}

  <main>
    <div class="top-bar">
      <h1>Items</h1>
      <a href="/items/new" class="btn-primary">+ New Item</a>
    </div>

    <!-- Summary -->
    <div class="summary-row">
      <div class="summary-card">
        <div class="label">Total Cost</div>
        <div class="value">{{ totals.cost | round(2) }}</div>
      </div>
      <div class="summary-card">
        <div class="label">Total Sales</div>
        <div class="value">{{ totals.sales | round(2) }}</div>
      </div>
      <div class="summary-card">
        <div class="label">Consignor Payout (total)</div>
        <div class="value">{{ (totals.consignor/1) | round(2) }}</div>
      </div>
      <div class="summary-card">
        <div class="label">House Net / Profit</div>
        <div class="value">{{ totals.house | round(2) }}</div>
      </div>
    </div>

    <!-- Filters -->
    <form class="filters" method="get" action="/items">
      <div class="filters-row">
        <div>
          <label for="q">Search</label>
          <input id="q" name="q" placeholder="Title, SKU, notes, buyer, consignor..."
                 value="{{ q or '' }}">
        </div>
        <div>
          <label for="ownership">Ownership</label>
          <select id="ownership" name="ownership">
            <option value="">All</option>
            <option value="owned"     {% if ownership == 'owned' %}selected{% endif %}>Owned</option>
            <option value="consigned" {% if ownership == 'consigned' %}selected{% endif %}>Consigned</option>
            <option value="internal"  {% if ownership == 'internal' %}selected{% endif %}>Internal</option>
          </select>
        </div>
        <div>
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="">All</option>
            <option value="available" {% if status == 'available' %}selected{% endif %}>Available</option>
            <option value="sold"      {% if status == 'sold' %}selected{% endif %}>Sold</option>
          </select>
        </div>
        <div>
          <label for="consignor_id">Consignor</label>
          <select id="consignor_id" name="consignor_id">
            <option value="">All / House</option>
            {% for c in consignors %}
              <option value="{{ c.id }}"
                {% if consignor_id and consignor_id == c.id %}selected{% endif %}>
                {{ c.name }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="filters-row">
        <div>
          <label for="building">Building</label>
          <select id="building" name="building">
            <option value="">Any</option>
            {% for b in buildings %}
              <option value="{{ b }}" {% if building == b %}selected{% endif %}>{{ b }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="room">Room / Area</label>
          <select id="room" name="room">
            <option value="">Any</option>
            {% for r in rooms %}
              <option value="{{ r }}" {% if room == r %}selected{% endif %}>{{ r }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="shelf">Shelf / Rack</label>
          <select id="shelf" name="shelf">
            <option value="">Any</option>
            {% for s in shelves %}
              <option value="{{ s }}" {% if shelf == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="tote">Tote / Bin</label>
          <select id="tote" name="tote">
            <option value="">Any</option>
            {% for t in totes %}
              <option value="{{ t }}" {% if tote == t %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="filters-row">
        <div>
          <label for="location">Location text contains</label>
          <input id="location" name="location"
                 placeholder="e.g. Barn, Back room, Top shelf"
                 value="{{ location or '' }}">
        </div>
      </div>

      <div class="filters-actions">
        <button type="submit" class="btn-small btn-apply">Apply Filters</button>
        <a href="/items" class="btn-small btn-reset">Reset</a>
      </div>
    </form>

    <!-- Items table -->
    <table>
      <thead>
        <tr>
          <th>SKU</th>
          <th>Title</th>
          <th>Ownership</th>
          <th>Consignor</th>
          <th>Location</th>
          <th>Shelf / Tote</th>
          <th>Status &amp; Price</th>
          <th>Buyer</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if items %}
          {% for it in items %}
          <tr>
            <td>{{ it.sku }}</td>
            <td>
              {{ it.title }}
              {% if it.category %}
                <div style="font-size:11px; color:#777;">{{ it.category }}</div>
              {% endif %}
            </td>
            <td>
              {% set own = (it.ownership or '')|lower %}
              {% if own == 'consigned' %}
                <span class="tag tag-consigned">Consigned</span>
              {% elif own == 'internal' %}
                <span class="tag tag-internal">Internal</span>
              {% else %}
                <span class="tag tag-owned">Owned</span>
              {% endif %}
            </td>
            <td>
              {{ it.consignor or '' }}
            </td>
            <td>
              {% if it.location %}
                <strong>{{ it.location }}</strong><br>
              {% endif %}
              <span style="font-size:11px; color:#777;">
                {% if it.building %}{{ it.building }}{% endif %}
                {% if it.room %} â€¢ {{ it.room }}{% endif %}
              </span>
            </td>
            <td>
              <span style="font-size:11px;">
                {% if it.shelf %}Shelf: {{ it.shelf }}{% endif %}
                {% if it.tote %}{% if it.shelf %}<br>{% endif %}Tote: {{ it.tote }}{% endif %}
              </span>
            </td>
            <td>
              {% if it.status == 'sold' %}
                <span class="tag tag-sold">Sold</span><br>
                <span style="font-size:12px;">
                  Sale: {{ it.sale_price_cents | money }}<br>
                  Payout: {{ it.consignor_payout | money }}<br>
                  House: {{ it.house_net | money }}
                </span>
              {% else %}
                <span class="tag">Available</span><br>
                <span style="font-size:12px;">
                  Cost: {{ it.cost_cents | money }}<br>
                  Asking: {{ it.asking_cents | money }}
                </span>
              {% endif %}
            </td>
            <td>
              {% if it.buyer_name %}
                {{ it.buyer_name }}<br>
              {% endif %}
              {% if it.sale_date %}
                <span style="font-size:11px; color:#777;">
                  {{ it.sale_date.isoformat() }}
                </span>
              {% endif %}
            </td>
            <td class="actions">
              <a href="/items/{{ it.id }}/edit">Edit</a>
              <a href="/items/{{ it.id }}/photos">Photos</a>
              {% if it.status != 'sold' %}
                <a href="/items/{{ it.id }}/sell">Sell</a>
              {% endif %}
              <a href="/items/{{ it.id }}/print">Label</a>
              <a href="/items/{{ it.id }}/clone">Clone</a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9">No items found with the current filters.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </main>
</body>
</html>
