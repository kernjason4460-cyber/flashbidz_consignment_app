{% include "_navbar.html" %}

<main class="page">

  <h1>Consignor: {{ consignor.name }}</h1>
{% set contract_id = None %}
{% for it in items %}
  {% if it.contract_id %}
    {% set contract_id = it.contract_id %}
  {% endif %}
{% endfor %}

{% if contract_id %}
  <p>
    <a href="{{ url_for('contract_view', contract_id=contract_id) }}"
       style="display:inline-block;padding:8px 14px;background:#111;
              color:#fff;text-decoration:none;border-radius:4px">
      View Current Contract
    </a>
  </p>
{% endif %}
  <p style="margin-top: 4px; color: #666;">
    Email: {{ consignor.email or "-" }} ·
    Phone: {{ consignor.phone or "-" }} ·
    Commission: {{ "%.2f"|format(consignor.commission_pct or 0) }}%
  </p>

  <!-- FlashBidz-style stat cards -->
  <div style="display: flex; flex-wrap: wrap; gap: 16px; margin: 20px 0;">

    <div style="background:#000; color:#fff; padding:14px 18px;
                border-left:4px solid #e00000; border-radius:6px; min-width:160px;">
      <div style="font-size:12px; opacity:0.8;">Total Items</div>
      <div style="font-size:24px; font-weight:bold;">{{ stats.total_items }}</div>
    </div>

    <div style="background:#000; color:#fff; padding:14px 18px;
                border-left:4px solid #e00000; border-radius:6px; min-width:160px;">
      <div style="font-size:12px; opacity:0.8;">Sold Items</div>
      <div style="font-size:24px; font-weight:bold;">{{ stats.sold_items }}</div>
    </div>

    <div style="background:#000; color:#fff; padding:14px 18px;
                border-left:4px solid #e00000; border-radius:6px; min-width:160px;">
      <div style="font-size:12px; opacity:0.8;">Total Sales</div>
      <div style="font-size:24px; font-weight:bold;">
        ${{ "%.2f"|format(stats.total_sales) }}
      </div>
    </div>

  </div>

  <h2 style="margin-top: 24px;">Recent Items</h2>

  {% if items %}
    <table border="1" cellpadding="4" cellspacing="0" style="margin-top: 8px; width: 100%; max-width: 900px;">
      <tr>
        <th align="left">Lot / Item</th>
        <th align="left">Title</th>
        <th align="left">Created</th>
        <th align="left">Sale Price</th>
      </tr>
      {% for item in items %}
        <tr>
          <td>{{ item.sku or "-" }}</td>
          <td>
            <a href="{{ url_for('items_edit', id=item.id) }}">
              {{ item.title or "(no title)" }}
            </a>
          </td>
          <td>{{ item.created_at or "" }}</td>
          <td>
            {% if item.sale_price_cents %}
              ${{ "%.2f"|format(item.sale_price_cents / 100.0) }}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No items for this consignor yet.</p>
  {% endif %}

</main>
