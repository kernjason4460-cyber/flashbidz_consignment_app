{% extends "base.html" %}
{% block title %}Manage Users{% endblock %}

{% block content %}
<h1>Manage Users</h1>

<p>Logged in as: {{ session.username or "?" }} ({{ session.role or "" }})</p>

<h2>Create New User</h2>
<form method="post" action="{{ url_for('users_new') }}">
  <div>
    <label>Username</label>
    <input type="text" name="username" required>
  </div>
  <div>
    <label>Password</label>
    <input type="password" name="password" required>
  </div>
  <div>
    <label>Role</label>
    <select name="role">
      <option value="staff">Staff</option>
      <option value="admin">Admin</option>
    </select>
  </div>
  <button type="submit">Create User</button>
</form>

<hr>

<h2>Existing Users</h2>
<table border="1" cellpadding="4">
  <tr>
    <th>ID</th>
    <th>Username</th>
    <th>Role</th>
    <th>Created</th>
    <th>Actions</th>
  </tr>
  {% for u in users %}
  <tr>
    <td>{{ u.id }}</td>
    <td>{{ u.username }}</td>
    <td>{{ u.role }}</td>
    <td>{{ u.created_at }}</td>
    <td>
      <form method="post" action="{{ url_for('users_set_role', uid=u.id) }}" style="display:inline;">
        <select name="role">
          <option value="staff" {% if u.role == 'staff' %}selected{% endif %}>Staff</option>
          <option value="admin" {% if u.role == 'admin' %}selected{% endif %}>Admin</option>
        </select>
        <button type="submit">Update Role</button>
      </form>

      {% if u.username != 'admin' %}
      <form method="post" action="{{ url_for('users_delete', uid=u.id) }}" style="display:inline;" onsubmit="return confirm('Delete this user?');">
        <button type="submit">Delete</button>
      </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
