<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Consignment Contract #{{ contract.id }}</title>
    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 24px; }
        h1, h2, h3 { margin-bottom: 4px; }
        .header { display:flex; justify-content:space-between; align-items:flex-start; border-bottom:2px solid #000; padding-bottom:8px; margin-bottom:16px; }
        .brand { font-weight:800; color:#e60000; font-size:20px; }
        .status-pill { padding:4px 10px; border-radius:999px; font-size:12px; text-transform:uppercase; }
        .status-draft { background:#fff4cc; color:#a66a00; border:1px solid #f0d48a; }
        .status-locked { background:#e6ffed; color:#0b7a2a; border:1px solid #9ae6b4; }

        .section { margin-bottom:18px; }
        .label { font-weight:600; }
        table { width:100%; border-collapse:collapse; margin-top:6px; font-size:13px; }
        th, td { border:1px solid #ccc; padding:4px 6px; text-align:left; }
        th { background:#f5f5f5; }
        .totals { margin-top:8px; font-size:13px; }
        .totals div { margin:2px 0; }

        .terms { font-size:12px; line-height:1.4; }
        .terms p { margin:4px 0; }
        .terms ol { margin:4px 0 4px 18px; padding:0; }

        .signature-blocks { display:flex; gap:32px; margin-top:24px; font-size:12px; }
        .sig-box { flex:1; }
        .sig-line { border-bottom:1px solid #000; height:24px; margin-bottom:4px; }

        @media print {
            .no-print { display:none !important; }
            body { margin:0.5in; }
        }
    </style>
</head>
<body>

<div class="header">
    <div>
        <div class="brand">⚡ FlashBidz</div>
        <div style="font-size:12px;margin-top:4px;">
            {{ settings.store_address or "Mattawan, Michigan" }}<br>
            {{ settings.store_phone or "" }}
        </div>
    </div>
    <div style="text-align:right;font-size:12px;">
        <div><strong>Consignment Contract</strong></div>
        <div>Contract #: {{ contract.id }}</div>
        <div>Date Created: {{ contract.created_at }}</div>
        <div>Status:
            {% if contract.status == "locked" %}
                <span class="status-pill status-locked">Locked</span>
            {% else %}
                <span class="status-pill status-draft">Draft</span>
            {% endif %}
        </div>
        <div class="no-print" style="margin-top:6px;">
            <button onclick="window.print()">Print / Save as PDF</button>
        </div>
    </div>
</div>

<div class="section">
    <h2>Consignor Information</h2>
    <div style="font-size:13px;">
        <div><span class="label">Name:</span> {{ consignor.name }}</div>
        <div>
            <span class="label">Address:</span>
            {{ consignor.street or "" }}
            {% if consignor.city %}, {{ consignor.city }}{% endif %}
            {% if consignor.state %}, {{ consignor.state }}{% endif %}
            {% if consignor.postal_code %} {{ consignor.postal_code }}{% endif %}
        </div>
        <div><span class="label">Phone:</span> {{ consignor.phone or "" }}</div>
        <div><span class="label">Email:</span> {{ consignor.email or "" }}</div>
    </div>
</div>

<div class="section">
    <h2>Items Covered by This Contract</h2>
    <table>
        <thead>
            <tr>
                <th>SKU</th>
                <th>Title</th>
                <th>Status</th>
                <th>Asking</th>
                <th>Sale Price</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for it in items %}
            <tr>
                <td>{{ it.sku }}</td>
                <td>{{ it.title }}</td>
                <td>{{ it.status }}</td>
                <td>
                    {% if it.asking_cents is not none %}
                        ${{ '%.2f'|format(it.asking_cents/100) }}
                    {% endif %}
                </td>
                <td>
                    {% if it.sale_price_cents is not none %}
                        ${{ '%.2f'|format(it.sale_price_cents/100) }}
                    {% endif %}
                </td>
                <td>{{ it.notes or '' }}</td>
            </tr>
            {% endfor %}
            {% if not items %}
            <tr>
                <td colspan="6" style="text-align:center;font-style:italic;">No items currently attached to this contract.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <div class="totals">
        <div><span class="label">Total items:</span> {{ total_items }}</div>
        <div><span class="label">Estimated asking total:</span> ${{ '%.2f'|format(total_estimated) }}</div>
        <div><span class="label">Estimated sale total (if sold):</span> ${{ '%.2f'|format(total_sale_estimate) }}</div>
        <div><span class="label">Commission rate:</span> {{ '%.0f'|format(commission_pct or 0) }}% of final sale price (unless otherwise noted).</div>
    </div>
</div>

<div class="section terms">
    <h2>Terms &amp; Conditions</h2>
    <ol>
        <li><strong>Authorization to Sell.</strong> Consignor authorizes FlashBidz LLC (“Auctioneer”) to photograph, list, market, and sell the above items through online auctions, in-store sales, or other sales channels used by FlashBidz.</li>

        <li><strong>Commission &amp; Fees.</strong> For each item sold, Consignor agrees that FlashBidz will retain a commission equal to
            {{ '%.0f'|format(commission_pct or 0) }}% of the final sale price, plus any applicable buyer’s premium, sales tax, payment processing, platform, or advertising fees retained by FlashBidz. Commission may be adjusted in writing on a per-consignor or per-item basis.</li>

        <li><strong>Payment to Consignor.</strong> Net proceeds (after commission, fees, chargebacks, and returns) will be paid to Consignor within 30 days after the close of the auction or sale in which the items are paid in full, subject to cleared funds.</li>

        <li><strong>Title &amp; Authenticity.</strong> Consignor represents and warrants that they are the lawful owner of the items or authorized to sell them, that items are free of liens and encumbrances, and that any brand, autograph, or authenticity claims are true to the best of their knowledge.</li>

        <li><strong>Condition, Inspection &amp; “As-Is” Sale.</strong> All items are sold “AS-IS, WHERE-IS,” with no guarantees by FlashBidz regarding condition, fitness, or completeness. Descriptions and photos are provided as a good-faith guide only and may not capture every detail. Bidders are encouraged to inspect items in person prior to bidding.</li>

        <li><strong>Unsold Items &amp; Storage.</strong> Unless otherwise agreed in writing, Consignor must pick up unsold items within 7 calendar days after being notified that the auction or sale is complete. After 7 days, a storage fee of $2.00 per item per day may be charged. After 14 days, any remaining items may be considered abandoned and may be donated, disposed of, or sold at the sole discretion of FlashBidz, with no further proceeds due to Consignor.</li>

        <li><strong>Loss or Damage.</strong> Reasonable care will be used in handling and storing items; however, Consignor understands that minor handling wear may occur in the normal course of photographing, moving, and showing items. FlashBidz is not liable for damage or loss caused by events outside its reasonable control (including theft, fire, water damage, or acts of nature) beyond any insurance actually recovered.</li>

        <li><strong>Pricing &amp; Sale Method.</strong> FlashBidz has discretion to lot, describe, photograph, start bids, group items, run sales multiple times, and choose the sales channel(s) that it believes will best promote the items, unless specific written instructions are agreed and attached to this contract.</li>

        <li><strong>Chargebacks &amp; Non-Payment.</strong> If a buyer fails to pay, cancels, or reverses payment, FlashBidz may cancel the sale, re-offer the item, or return the item to Consignor. No commission will be paid on cancelled or unpaid sales.</li>

        <li><strong>Term; Locked Contracts.</strong> This contract covers the items listed while the status is “Draft.” When signed below and marked “Locked” in the FlashBidz system, the contract is finalized for those items. New items will be placed on a new, separate contract.</li>

        <li><strong>Entire Agreement.</strong> This agreement, plus any written addenda attached hereto, constitutes the entire agreement between the parties regarding the consignment of these items and supersedes any prior verbal agreements.</li>
    </ol>
</div>

<div class="signature-blocks">
    <div class="sig-box">
        <div class="label">Consignor</div>
        <div class="sig-line"></div>
        <div>Signature</div>
        <div class="sig-line"></div>
        <div>Printed Name</div>
        <div class="sig-line"></div>
        <div>Date</div>
    </div>
    <div class="sig-box">
        <div class="label">FlashBidz Representative</div>
        <div class="sig-line"></div>
        <div>Signature</div>
        <div class="sig-line"></div>
        <div>Printed Name</div>
        <div class="sig-line"></div>
        <div>Date</div>
    </div>
</div>

{% if contract.status != "locked" and session.get('role') == 'admin' %}
<form method="post" action="{{ url_for('contract_lock', contract_id=contract.id) }}" class="no-print" style="margin-top:16px;">
    <button type="submit" style="background:#e60000;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;">
        Mark Contract as Locked (Signed)
    </button>
</form>
{% endif %}

</body>
</html>
